// pnltri.js / raw.github.com/jahting/pnltri.js/master/LICENSE
'use strict';var r={ea:"1.4"};r.d={random:Math.random,fa:function(b){for(var c=b.length-1;0<c;c--){var h=Math.floor(r.d.random()*(c+1)),f=b[c];b[c]=b[h];b[h]=f}return b},P:function(b,c,h){return(c.x-b.x)*(h.y-b.y)-(c.y-b.y)*(h.x-b.x)},ca:function(b){return Math.sqrt(b.x*b.x+b.y*b.y)},ha:function(b,c){return b.x*c.x+b.y*c.y},ga:function(b,c){return b.x*c.y-c.x*b.y},ia:function(b,c,h){c={x:c.x-b.x,y:c.y-b.y};b={x:h.x-b.x,y:h.y-b.y};h=r.d.ha(c,b)/r.d.ca(c)/r.d.ca(b);return 0<=r.d.ga(c,b)?1-h:3+h},H:function(b,c){var h=b.y-c.y;if(h<
r.d.F)return-1;if(h>r.d.m)return 1;h=b.x-c.x;return h<r.d.F?-1:h>r.d.m?1:0}};r.d.m=Math.pow(2,-43);r.d.F=-r.d.m;function u(b){this.da=[];this.r=[];this.N=0;this.G=[];this.p=[];this.W=[];if(b)for(var c=0,h=b.length;c<h;c++){var f=w(this,b[c]);if(3>f.length)console.log("Polygon has < 3 vertices!",f);else{for(var a=void 0,d=void 0,g=void 0,e=0;e<f.length-1;e++)a=x(this,f[e],f[e+1]),g?(a.o=g,g.l=a):d=a,g=a,this.r.push(a);a=x(this,f[f.length-1],f[0]);a.o=g;g.l=a;this.r.push(a);d.o=a;a.l=d;this.G[this.N++]=!0}}}u.prototype={T:function(){return this.G.concat()}};function B(b,c,h,f){b.W.push([c.id,h.id,f.id])}
function D(b,c,h,f,a){var d=E(h,f).Q,g=E(f,h).Q,e=F(b,{c:h,i:f,t:!0,h:d.h,g:g});h=F(b,{c:f,i:h,t:!1,h:g.h,g:d});d.h.g=e;g.h.g=h;d.h=h;g.h=e;d=b.p.length;a?(b.p[c]=e,b.p[d]=h):(b.p[c]=h,b.p[d]=e);return d}function E(b,c){for(var h,f,a=null,d=4,g=0;g<b.A.length;g++)h=b.A[g],(f=r.d.ia(b,h.X,c))<=d&&(d=f,a=h);return a}function F(b,c){b.r.push(c);c.c.A.push({Q:c,X:c.i});return c}
function w(b,c){function h(a,b){return Math.abs(a.x-b.x)<r.d.m&&Math.abs(a.y-b.y)<r.d.m}function f(a,b,c){if(Math.abs(r.d.P(b,a,c))>r.d.m)return!1;var d;Math.abs(a.y-b.y)<r.d.m?(d=b.x,a.x<c.x?(b=a.x,a=c.x):(b=c.x,a=a.x)):(d=b.y,a.y<c.y?(b=a.y,a=c.y):(b=c.y,a=a.y));return b-d<r.d.m&&d-a<r.d.m}for(var a=[],d,g,e,m=0;m<c.length;m++)d=G(b,c[m].x,c[m].y),g=!0,e=a.length-1,0<=e&&(h(d,a[e])?g=!1:0<e&&f(a[e-1],a[e],d)&&a.pop()),g&&a.push(d);e=a.length-1;0<e&&h(a[e],a[0])&&(a.pop(),e--);1<e&&(f(a[e-1],a[e],
a[0])&&(a.pop(),e--),1<e&&f(a[e],a[0],a[1])&&a.shift());return a}function x(b,c,h){return{S:b.N,c:c,i:h,t:1==r.d.H(h,c),o:null,l:null,I:null,J:null,w:!1,K:null,L:null,h:null,g:null,U:!1}}function G(b,c,h){c={id:b.da.length,x:c,y:h,A:[]};b.da.push(c);return c};function H(b){this.j=b}H.prototype={};function I(b,c,h,f){this.v=b?b:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY};this.n=c?c:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY};this.q=h;this.s=f;this.depth=-1;this.V=!1}I.prototype={};function J(b){var c=new I(b.v,b.n,b.q,b.s);c.e=b.e;c.f=b.f;c.a=b.a;c.b=b.b;c.u=b.u;return c}function K(b){this.B=b;b.u=this}K.prototype={};
function L(b){var c=new I(null,null,null,null);this.C=[];N(this,c);this.root=new K(c);if(b)for(b=b.r,c=0;c<b.length;c++)b[c].I=b[c].J=this.root,b[c].w=!1}L.prototype={M:function(){for(var b,c=0,h=this.C.length;c<h;c++)if(b=this.C[c],1==b.depth%2&&!b.V&&(!b.e&&!b.f||!b.a&&!b.b)&&b.q)return b;return null}};
function O(b,c){function h(){var a=l.e||l.f;a.a&&a.b?l==a.a?(n.e=null,a.a=q):(q.f=null,a.b=n):(n.e=null,n.f=a,a.b=n)}function f(a){l.n==t.n?(e?l.a?(a.e=q,q.a=a,n.b=null):(a.f=n,q.a=null,n.b=a):(a.e=q,a.f=n,q.a=n.b=a),q.b=n.a=null):(a.e&&a.f&&(a.e==l?(a.D=a.f,a.ba=!0):(a.D=a.e,a.ba=!1)),a.e=q,a.f=n,q.b=n.a=a,q.a=n.b=null)}function a(){var a;if(l.n==t.n&&e)l.a.e=q,l.b.f=n,q.a=l.a,n.b=l.b,a=q.b=n.a=null;else{l.a.e=q;l.b.f=n;var b=P(c,l.n);if(0<b)a=l.b,l.b.e=q,q.a=l.a,n.b=null;else if(0>b)a=l.a,l.a.f=
n,n.b=l.b,q.a=null;else{a=l.a.s;var d=a.t,b=d?a.c:a.i,b=P(c,b);0<b?(a=l.b,l.b.e=q,q.a=l.a,n.b=null):0>b?(a=l.a,l.a.f=n,n.b=l.b,q.a=null):(a=d?a.l:a.o,b=d?a.i:a.c,b=P(c,b),0<b?(a=l.b,l.b.e=q,q.a=l.a,n.b=null):(a=l.a,l.a.f=n,n.b=l.b,q.a=null))}q.b=n.a=a}return a}Q(c);var d,g,e,m,k,p;c.t?(d=c.c,m=c.i,g=c.I,k=c.J,e=c.o.w,p=c.l.w):(d=c.i,m=c.c,g=c.J,k=c.I,e=c.l.w,p=c.o.w);p||(p=R(b,k,m,!1),k==g&&(g=p),k=p);k=k.B;if(k.e||k.f)if(k.v!=m)console.log("ERR add_segment: trFirstHigh != segHigh: ",k);else{e||(g=
R(b,g,d,!0));var t=g.B,l=k,q,n,y,v;for(d=b.C.length+2;l;){if(0>--d){console.log("ERR add_segment: infinite loop",l,c,b);return}if(!l.a&&!l.b){console.log("ERR add_segment: missing successors",l,c,b);return}g=l.u;g.k=c;g.B=null;v&&v.s==l.s?(q=l,n=v,n.n=l.n,g.left=new K(q),g.right=v.u):(y&&y.q==l.q?(n=l,q=y,q.n=l.n,g.left=y.u):(q=l,n=ba(b,l),g.left=new K(q)),g.right=new K(n));l.e&&l.f?l.D?(l.ba?(n.e=l.f,n.f=l.D,n.e.a=n,n.f.b=n):(q.f=l.e,q.e=l.D,q.e.a=q,q.f.b=q),q.D=n.D=null):l.v==k.v?(n.f.b=n,q.f=n.e=
null):n==l?(n.e=n.f,n.f=null,n.e.a=n):(q.f=q.e,q.e=null):h();l.a&&l.b?g=a():(g=l.a?l.a:l.b,f(g));q.s&&(q.s.K=n);n.q&&(n.q.L=q);q.s=n.q=c;c.K=q;c.L=n;l.n!=t.n?(y=q,v=n,l=g):l=null}c.w=!0}else console.log("ERR add_segment: missing trFirst.uX: ",k)}
function S(b,c){if(c)var h=b.c,f=b.i,a=b.I;else h=b.i,f=b.c,a=b.J;for(var d;a;)if(a.Y)d=h==a.Y?f:h,d=r.d.H(d,a.Y),a=-1==d?a.left:a.right;else if(a.k)if(h==a.k.c||h==a.k.i)if(Math.abs(h.y-f.y)<r.d.m)a=f.x<h.x?a.left:a.right;else if(d=P(a.k,f),0<d)a=a.left;else if(0>d)a=a.right;else if(d=h==a.k.c?(d=a.k.t?f.y<a.k.i.y:f.y>=a.k.i.y)?P(a.k,b.o.c):-P(a.k,a.k.l.i):(d=a.k.t?f.y>=a.k.c.y:f.y<a.k.c.y)?P(a.k,b.l.i):-P(a.k,a.k.o.c),0<d)a=a.left;else if(0>d)a=a.right;else break;else if(d=P(a.k,h),0<d)a=a.left;
else if(0>d)a=a.right;else if(d=P(a.k,f),0<d)a=a.left;else if(0>d)a=a.right;else if(d=P(a.k,c?b.o.c:b.l.i),0<d)a=a.left;else if(0>d)a=a.right;else break;else{a.B||console.log("ptNode: unknown type",a);c?b.I=a:b.J=a;break}}function Q(b){S(b,!0);S(b,!1)}function P(b,c){var h;h=b.c.x-c.x;var f=b.i.x-c.x,a=Math.abs(b.c.y-c.y)<r.d.m;if(Math.abs(b.i.y-c.y)<r.d.m){if(a)return 0;h=f}else if(!a)return b.t?r.d.P(b.c,b.i,c):r.d.P(b.i,b.c,c);return Math.abs(h)<r.d.m?0:h}
function R(b,c,h,f){var a=c.B;if(a.v==h||a.n==h)return c;var d=J(a);a.n=d.v=h;a.a=d;d.e=a;a.b=d.f=null;d.a&&(d.a.e=d);d.b&&(d.b.f=d);N(b,d);c.Y=h;c.B=null;c.right=new K(a);c.left=new K(d);return f?a.u:d.u}function ba(b,c){var h=J(c);N(b,h);return h}function N(b,c){c.ka=b.C.length;b.C.push(c)}function X(b){this.j=b;this.$=new L(this.j)}X.prototype={M:function(){return this.$.M()}};function Y(b){this.j=b;this.aa=this.R=null}Y.prototype={};
function ca(b,c,h){var f=null,a=null;function d(){var a;return(a=g.pop())?(e=a[0],m=a[1],k=a[2],p=a[3],!0):!1}var g=[],e,m,k,p,t;null==f&&(a=!0,h.e?f=!0:h.a?f=!1:(a=!1,f=h.f?!0:!1));for(h&&g.push([h,f,a,c]);d();)if(!e.V){e.V=!0;if(!e.q||!e.s){console.log("ERR alyTrap: lseg/rseg missing",e);break}m?k?(c=e.e,h=e.f,f=e.a,a=e.b):(c=e.f,h=e.e,f=e.b,a=e.a):k?(c=e.a,h=e.b,f=e.e,a=e.f):(c=e.b,h=e.a,f=e.f,a=e.e);if(h||a)t=D(b.j,p,e.n,e.v,k);a&&g.push([a,m,!k,t]);h&&g.push([h,!m,!k,t]);f&&g.push([f,m,k,p]);
f||a||c&&g.push([c,!m,k,p])}};function Z(b){this.j=b}Z.prototype={};function $(){this.O=null}
$.prototype={Z:function(){this.O=null},T:function(){return this.O?this.O.T():null},ja:function(b,c){this.Z();if(!b||0==b.length)return[];var h=new u(b),f=c?!1:1==h.N;if(f){f=new H(h);a:{var a=f.j,d=a.r[0],g=d,e=d,m=0;do m+=(e.c.x-e.i.x)*(e.c.y+e.i.y),e=e.l;while(e!=d);if(0>m){do g.h=g.l,g=g.g=g.o;while(g!=d);a.G[0]=!1}else{do g.h=g.o,g=g.g=g.l;while(g!=d)}for(d=a=d;a.g!=a.h;){b:{var g=a.h.c.x,e=a.h.c.y,m=a.c.x,k=a.c.y,p=a.g.c.x,t=a.g.c.y,l=p-m,q=t-k,n=g-p,y=e-t,v=m-g,M=k-e;if(r.d.m>v*q-l*M)g=!1;else{for(var aa=
a.h.h,C=a.g;C!=aa;){var C=C.g,z=C.c.x,A=C.c.y,T=z-g,U=A-e;if(0!=T||0!=U){var V=z-m,W=A-k;if(0!=V||0!=W)if(z-=p,A-=t,(0!=z||0!=A)&&l*W-q*V>=r.d.F&&v*U-M*T>=r.d.F&&n*A-y*z>=r.d.F){g=!1;break b}}}g=!0}}if(g)B(f.j,a.h.c,a.c,a.g.c),a.h.g=a.g,a.g.h=a.h,d=a=a.g;else if(a=a.g,a==d){f=!1;break a}}f=!0}}if(!f){f=new Y(h);f.R=new X(f.j);d=f.R;a=d.j.r.concat();r.d.fa(a);g=0;e=d.j.N;if(1!=e)for(m=Array(e),k=a.concat(),p=0;p<k.length;p++)t=k[p].S,m[t]?a[e++]=k[p]:(a[g++]=k[p],m[t]=!0);g=a.length;e=d.$;m=0;for(k=
g;m<g;){k=Math.log(k)/Math.LN2;for(p=1<k?Math.floor(g/k):g;m<p;m++)O(e,a[m]);for(p=m;p<g;p++)Q(a[p])}var d=d.j,e=[e.C[0]],m=[],s,p=0;do{for(t=1==p%2;k=e.pop();)-1==k.depth&&(k.depth=p,k.e&&e.push(k.e),k.f&&e.push(k.f),k.a&&e.push(k.a),k.b&&e.push(k.b),(s=k.q)&&-1==s.K.depth&&m.push(s.K),s=k.s)&&(-1==s.L.depth&&m.push(s.L),s.t!=t&&(d.G[s.S]=!1));e=m;m=[];p++}while(0<e.length);for(p=0;p<g;p++)a[p].K=a[p].L=null;f.aa=f.R.M();s=f.j;for(d=0;d<s.r.length;d++)a=s.r[d],s.G[a.S]?(a.h=a.o,a.g=a.l,a.c.A.push({Q:a,
X:a.i})):(a=a.l,a.h=a.l,a.g=a.o,a.c.A.push({Q:a,X:s.r[d].c}));for(s=f.aa;s;)a=ca,d=f,g=f.j,e=g.p.length,g.p[e]=s.q,a(d,e,s),s=f.R.M();s=f.j;m=[];for(k=0;k<s.p.length;k++){f=a=s.p[k];g=e=f.c;f.U=!0;f=f.g;for(p=!1;d=f.c;){if(f.U){d!=g&&(p=!0);break}else f.U=!0;1==r.d.H(d,e)&&(e=d,a=f);f=f.g}p||m.push(a)}s.p=m;s=f=new Z(h);f=s.j.p;s.j.W=[];for(a=0;a<f.length;a++)if(e=f[a],d=e.h,g=e.g,g.g==d)B(s.j,e.c,g.c,d.c);else if(d=s,g=e.g,e=e.c,m=[g.c],k=0,g=g.g,p=g.c,p!=e){for(;p!=e||1<k;)if(0<k)if(t=r.d.P(p,m[k-
1],m[k]),Math.abs(t)<=r.d.m&&r.d.H(p,m[k])!=r.d.H(m[k],m[k-1])&&(t=1),0<t)B(d.j,m[k-1],m[k],p),k--;else if(m[++k]=p,p==e)for(console.log("ERR uni-y-monotone: only concave angles left",m);1<k;)k--,B(d.j,m[k-1],m[k],m[k+1]);else g=g.g,p=g.c;else m[++k]=p,g=g.g,p=g.c;B(d.j,m[k-1],m[k],p)}s=h.r;for(f=0;f<s.length;f++)s[f].c.A=null}this.O=h;return h.W.concat()}};window.PNLTRI=r;r.REVISION=r.ea;r.Math=r.d;r.Triangulator=$;$.prototype.clear_lastData=$.prototype.Z;$.prototype.get_PolyLeftArr=$.prototype.T;$.prototype.triangulate_polygon=$.prototype.ja;
