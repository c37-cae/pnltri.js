// pnltri.js / raw.github.com/jahting/pnltri.js/master/LICENSE
'use strict';var r={ea:"1.4"};r.f={random:Math.random,fa:function(b){for(var c=b.length-1;0<c;c--){var e=Math.floor(r.f.random()*(c+1)),d=b[c];b[c]=b[e];b[e]=d}return b},V:function(b,c,e){return(c.x-b.x)*(e.y-b.y)-(c.y-b.y)*(e.x-b.x)},ca:function(b){return Math.sqrt(b.x*b.x+b.y*b.y)},ha:function(b,c){return b.x*c.x+b.y*c.y},ga:function(b,c){return b.x*c.y-c.x*b.y},ia:function(b,c,e){c={x:c.x-b.x,y:c.y-b.y};b={x:e.x-b.x,y:e.y-b.y};e=r.f.ha(c,b)/r.f.ca(c)/r.f.ca(b);return 0<=r.f.ga(c,b)?1-e:3+e},R:function(b,c){var e=b.y-c.y;if(e<
r.f.F)return-1;if(e>r.f.n)return 1;e=b.x-c.x;return e<r.f.F?-1:e>r.f.n?1:0}};r.f.n=Math.pow(2,-43);r.f.F=-r.f.n;function v(b){this.da=[];this.q=[];this.M=0;this.G=[];this.o=[];this.W=[];if(b)for(var c=0,e=b.length;c<e;c++){var d=w(this,b[c]);if(3>d.length)console.log("Polygon has < 3 vertices!",d);else{for(var a=void 0,g=void 0,f=void 0,h=0;h<d.length-1;h++)a=x(this,d[h],d[h+1]),f?(a.m=f,f.l=a):g=a,f=a,this.q.push(a);a=x(this,d[d.length-1],d[0]);a.m=f;f.l=a;this.q.push(a);g.m=a;a.l=g;this.G[this.M++]=!0}}}v.prototype={S:function(){return this.G.concat()}};function B(b,c,e,d){b.W.push([c.id,e.id,d.id])}
function D(b,c,e,d,a){var g=E(e,d).O,f=E(d,e).O,h=F(b,{c:e,j:d,B:!0,h:g.h,g:f});e=F(b,{c:d,j:e,B:!1,h:f.h,g:g});g.h.g=h;f.h.g=e;g.h=e;f.h=h;g=b.o.length;a?(b.o[c]=h,b.o[g]=e):(b.o[c]=e,b.o[g]=h);return g}function E(b,c){for(var e,d,a=null,g=4,f=0;f<b.v.length;f++)e=b.v[f],(d=r.f.ia(b,e.X,c))<g&&(g=d,a=e);return a}function F(b,c){b.q.push(c);c.c.v.push({O:c,X:c.j});return c}
function w(b,c){function e(a,b){return Math.abs(a.x-b.x)<r.f.n&&Math.abs(a.y-b.y)<r.f.n}for(var d=[],a,g,f,h=0;h<c.length;h++)a=G(b,c[h].x,c[h].y),g=!0,f=d.length-1,0<=f&&e(a,d[f])&&(g=!1),g&&d.push(a);1<d.length&&e(d[d.length-1],d[0])&&d.pop();return d}function x(b,c,e){return{Q:b.M,c:c,j:e,B:1==r.f.R(e,c),m:null,l:null,H:null,I:null,u:!1,J:null,K:null,h:null,g:null,T:!1}}function G(b,c,e){c={id:b.da.length,x:c,y:e,v:[]};b.da.push(c);return c};function H(b){this.i=b}H.prototype={};function I(b,c,e,d){this.D=b?b:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY};this.k=c?c:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY};this.p=e;this.r=d;this.depth=-1;this.U=!1}I.prototype={};function J(b){var c=new I(b.D,b.k,b.p,b.r);c.d=b.d;c.e=b.e;c.a=b.a;c.b=b.b;c.t=b.t;return c}function K(b){this.w=b;b.t=this}K.prototype={};
function L(b){var c=new I(null,null,null,null);this.A=[];N(this,c);this.root=new K(c);if(b)for(b=b.q,c=0;c<b.length;c++)b[c].H=b[c].I=this.root,b[c].u=!1}L.prototype={L:function(){for(var b,c=0,e=this.A.length;c<e;c++)if(b=this.A[c],1==b.depth%2&&!b.U&&(!b.d&&!b.e||!b.a&&!b.b)&&b.p)return b;return null}};
function O(b,c){function e(){var a=l.d||l.e;a.a&&a.b?l==a.a?(m.d=null,a.a=p):(p.e=null,a.b=m):(m.d=null,m.e=a,a.b=m)}function d(a){l.k==t.k?(h?l.a?(a.d=p,p.a=a,m.b=null):(a.e=m,p.a=null,m.b=a):(a.d=p,a.e=m,p.a=m.b=a),p.b=m.a=null):(a.d&&a.e&&(a.d==l?(a.C=a.e,a.ba=!0):(a.C=a.d,a.ba=!1)),a.d=p,a.e=m,p.b=m.a=a,p.a=m.b=null)}function a(){var a;if(l.k==t.k&&h)l.a.d=p,l.b.e=m,p.a=l.a,m.b=l.b,a=p.b=m.a=null;else{l.a.d=p;l.b.e=m;var b=P(c,l.k);if(0<b)a=l.b,l.b.d=p,p.a=l.a,m.b=null;else if(0>b)a=l.a,l.a.e=
m,m.b=l.b,p.a=null;else{a=l.a.r;var d=a.B,b=d?a.c:a.j,b=P(c,b);0<b?(a=l.b,l.b.d=p,p.a=l.a,m.b=null):0>b?(a=l.a,l.a.e=m,m.b=l.b,p.a=null):(a=d?a.l:a.m,b=d?a.j:a.c,b=P(c,b),0<b?(a=l.b,l.b.d=p,p.a=l.a,m.b=null):(a=l.a,l.a.e=m,m.b=l.b,p.a=null))}p.b=m.a=a}return a}Q(c);var g,f,h,n,k,q;c.B?(g=c.c,n=c.j,f=c.H,k=c.I,h=c.m.u,q=c.l.u):(g=c.j,n=c.c,f=c.I,k=c.H,h=c.l.u,q=c.m.u);q||(n=R(b,k,n,!1),k==f&&(f=n),k=n);k=k.w;if(k.d||k.e){h||(f=R(b,f,g,!0));var t=f.w,l=k,p,m,y,u;for(g=b.A.length+2;l;){if(0>--g){console.log("ERR add_segment: infinite loop",
l,c,b);return}if(!l.a&&!l.b){console.log("ERR add_segment: missing successors",l,c,b);return}f=l.t;f.s=c;f.w=null;u&&u.r==l.r?(p=l,m=u,m.k=l.k,f.left=new K(p),f.right=u.t):(y&&y.p==l.p?(m=l,p=y,p.k=l.k,f.left=y.t):(p=l,m=ba(b,l),f.left=new K(p)),f.right=new K(m));l.d&&l.e?l.C?(l.ba?(m.d=l.e,m.e=l.C,m.d.a=m,m.e.b=m):(p.e=l.d,p.d=l.C,p.d.a=p,p.e.b=p),p.C=m.C=null):l.D==k.D?(m.e.b=m,p.e=m.d=null):m==l?(m.d=m.e,m.e=null,m.d.a=m):(p.e=p.d,p.d=null):e();l.a&&l.b?f=a():(f=l.a?l.a:l.b,d(f));p.r&&(p.r.J=m);
m.p&&(m.p.K=p);p.r=m.p=c;c.J=p;c.K=m;l.k!=t.k?(y=p,u=m,l=f):l=null}c.u=!0}else console.log("ERR add_segment: missing trFirst.uX: ",k)}
function S(b,c){if(c)var e=b.c,d=b.j,a=b.H;else e=b.j,d=b.c,a=b.I;for(var g;a;)if(a.Y)g=e==a.Y?d:e,g=r.f.R(g,a.Y),a=-1==g?a.left:a.right;else if(a.s)e==a.s.c||e==a.s.j?Math.abs(e.y-d.y)<r.f.n?a=d.x<e.x?a.left:a.right:(g=P(a.s,d),a=0<g?a.left:0>g?a.right:e==a.s.c?a.right:a.left):(g=P(a.s,e),0<g?a=a.left:0>g?a=a.right:(g=P(a.s,d),0<g?a=a.left:0>g?a=a.right:(d=c?b.m.c:b.l.j,g=P(a.s,d),a=0<g?a.left:a.right)));else{a.w||console.log("ptNode: unknown type",a);c?b.H=a:b.I=a;break}}
function Q(b){S(b,!0);S(b,!1)}function P(b,c){var e,d;d=b.c.x-c.x;var a=b.j.x-c.x;e=Math.abs(b.c.y-c.y)<r.f.n;if(Math.abs(b.j.y-c.y)<r.f.n){if(e)return 0;e=a}else if(e)e=d,d=a;else return b.B?r.f.V(b.c,b.j,c):r.f.V(b.j,b.c,c);return Math.abs(e)<r.f.n?Math.abs(d)<r.f.n?0:d:e}function R(b,c,e,d){var a=c.w;if(a.D==e||a.k==e)return c;var g=J(a);a.k=g.D=e;a.a=g;g.d=a;a.b=g.e=null;g.a&&(g.a.d=g);g.b&&(g.b.e=g);N(b,g);c.Y=e;c.w=null;c.right=new K(a);c.left=new K(g);return d?a.t:g.t}
function ba(b,c){var e=J(c);N(b,e);return e}function N(b,c){c.ka=b.A.length;b.A.push(c)}function X(b){this.i=b;this.$=new L(this.i)}X.prototype={L:function(){return this.$.L()}};function Y(b){this.i=b;this.aa=this.P=null}Y.prototype={};
function ca(b,c,e){var d=null,a=null;function g(){var a;return(a=f.pop())?(h=a[0],n=a[1],k=a[2],q=a[3],!0):!1}var f=[],h,n,k,q,t;null==d&&(a=!0,e.d?d=!0:e.a?d=!1:(a=!1,d=e.e?!0:!1));for(e&&f.push([e,d,a,c]);g();)if(!h.U){h.U=!0;if(!h.p||!h.r){console.log("ERR alyTrap: lseg/rseg missing",h);break}n?k?(c=h.d,e=h.e,d=h.a,a=h.b):(c=h.e,e=h.d,d=h.b,a=h.a):k?(c=h.a,e=h.b,d=h.d,a=h.e):(c=h.b,e=h.a,d=h.e,a=h.d);if(e||a)t=D(b.i,q,h.k,h.D,k);a&&f.push([a,n,!k,t]);e&&f.push([e,!n,!k,t]);d&&f.push([d,n,k,q]);
d||a||c&&f.push([c,!n,k,q])}};function Z(b){this.i=b}Z.prototype={};function $(){this.N=null}
$.prototype={Z:function(){this.N=null},S:function(){return this.N?this.N.S():null},ja:function(b,c){this.Z();if(!b||0==b.length)return[];var e=new v(b),d=c?!1:1==e.M;if(d){d=new H(e);a:{var a=d.i,g=a.q[0],f=g,h=g,n=0;do n+=(h.c.x-h.j.x)*(h.c.y+h.j.y),h=h.l;while(h!=g);if(0>n){do f.h=f.l,f=f.g=f.m;while(f!=g);a.G[0]=!1}else{do f.h=f.m,f=f.g=f.l;while(f!=g)}for(g=a=g;a.g!=a.h;){b:{var f=a.h.c.x,h=a.h.c.y,n=a.c.x,k=a.c.y,q=a.g.c.x,t=a.g.c.y,l=q-n,p=t-k,m=f-q,y=h-t,u=n-f,M=k-h;if(r.f.n>u*p-l*M)f=!1;else{for(var aa=
a.h.h,C=a.g;C!=aa;){var C=C.g,z=C.c.x,A=C.c.y,T=z-f,U=A-h;if(0!=T||0!=U){var V=z-n,W=A-k;if(0!=V||0!=W)if(z-=q,A-=t,(0!=z||0!=A)&&l*W-p*V>=r.f.F&&u*U-M*T>=r.f.F&&m*A-y*z>=r.f.F){f=!1;break b}}}f=!0}}if(f)B(d.i,a.h.c,a.c,a.g.c),a.h.g=a.g,a.g.h=a.h,g=a=a.g;else if(a=a.g,a==g){d=!1;break a}}d=!0}}if(!d){d=new Y(e);d.P=new X(d.i);g=d.P;a=g.i.q.concat();r.f.fa(a);f=0;h=g.i.M;if(1!=h)for(n=Array(h),k=a.concat(),q=0;q<k.length;q++)t=k[q].Q,n[t]?a[h++]=k[q]:(a[f++]=k[q],n[t]=!0);f=a.length;h=g.$;n=0;for(k=
f;n<f;){k=Math.log(k)/Math.LN2;for(q=1<k?Math.floor(f/k):f;n<q;n++)O(h,a[n]);for(q=n;q<f;q++)Q(a[q])}var g=g.i,h=[h.A[0]],n=[],s,q=0;do{for(t=1==q%2;k=h.pop();)-1==k.depth&&(k.depth=q,k.d&&h.push(k.d),k.e&&h.push(k.e),k.a&&h.push(k.a),k.b&&h.push(k.b),(s=k.p)&&-1==s.J.depth&&n.push(s.J),s=k.r)&&(-1==s.K.depth&&n.push(s.K),s.B!=t&&(g.G[s.Q]=!1));h=n;n=[];q++}while(0<h.length);for(q=0;q<f;q++)a[q].J=a[q].K=null;d.aa=d.P.L();s=d.i;for(g=0;g<s.q.length;g++)a=s.q[g],s.G[a.Q]?(a.h=a.m,a.g=a.l,a.c.v.push({O:a,
X:a.j})):(a=a.l,a.h=a.l,a.g=a.m,a.c.v.push({O:a,X:s.q[g].c}));for(s=d.aa;s;)a=ca,g=d,f=d.i,h=f.o.length,f.o[h]=s.p,a(g,h,s),s=d.P.L();s=d.i;n=[];for(k=0;k<s.o.length;k++){d=a=s.o[k];f=h=d.c;d.T=!0;d=d.g;for(q=!1;(g=d.c)!=f;){if(d.T){q=!0;break}else d.T=!0;1==r.f.R(g,h)&&(h=g,a=d);d=d.g}q||n.push(a)}s.o=n;s=d=new Z(e);d=s.i.o;s.i.W=[];for(a=0;a<d.length;a++)if(h=d[a],g=h.h,f=h.g,f.g==g)B(s.i,h.c,f.c,g.c);else if(g=s,f=h.g,h=h.c,n=[f.c],k=0,f=f.g,q=f.c,q!=h){for(;q!=h||1<k;)if(0<k)if(0<r.f.V(q,n[k-
1],n[k]))B(g.i,n[k-1],n[k],q),k--;else if(n[++k]=q,q==h)for(console.log("ERR uni-y-monotone: only concave angles left",n);1<k;)k--,B(g.i,n[k-1],n[k],n[k+1]);else f=f.g,q=f.c;else n[++k]=q,f=f.g,q=f.c;B(g.i,n[k-1],n[k],q)}s=e.q;for(d=0;d<s.length;d++)s[d].c.v=null}this.N=e;return e.W.concat()}};window.PNLTRI=r;r.REVISION=r.ea;r.Math=r.f;r.Triangulator=$;$.prototype.clear_lastData=$.prototype.Z;$.prototype.get_PolyLeftArr=$.prototype.S;$.prototype.triangulate_polygon=$.prototype.ja;
