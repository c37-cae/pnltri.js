// pnltri.js / raw.github.com/jahting/pnltri.js/master/LICENSE
'use strict';var r={aa:"1.4"};r.b={random:Math.random,ba:function(b){for(var c=b.length-1;0<c;c--){var k=Math.floor(r.b.random()*(c+1)),g=b[c];b[c]=b[k];b[k]=g}return b},G:function(b,c){var k=b.y-c.y;if(k<r.b.D)return-1;if(k>r.b.n)return 1;k=b.x-c.x;return k<r.b.D?-1:k>r.b.n?1:0},O:function(b,c,k){return(c.x-b.x)*(k.y-b.y)-(c.y-b.y)*(k.x-b.x)},$:function(b){return Math.sqrt(b.x*b.x+b.y*b.y)},da:function(b,c){return b.x*c.x+b.y*c.y},ca:function(b,c){return b.x*c.y-c.x*b.y},ga:function(b,c,k){c={x:c.x-b.x,y:c.y-b.y};b={x:k.x-b.x,
y:k.y-b.y};k=r.b.da(c,b)/r.b.$(c)/r.b.$(b);return 0<=r.b.ca(c,b)?1-k:3+k}};r.b.n=Math.pow(2,-43);r.b.D=-r.b.n;function u(b){this.Q=[];this.s=[];this.L=0;this.F=[];this.w=[];this.U=[];if(b)for(var c=0,k=b.length;c<k;c++){var g=w(this,b[c]);if(3>g.length)console.log("Polygon has < 3 vertices!",g);else{for(var a=void 0,d=void 0,e=void 0,h=0;h<g.length-1;h++)a=x(this,g[h],g[h+1]),e?(a.o=e,e.l=a):d=a,e=a,this.s.push(a);a=x(this,g[g.length-1],g[0]);a.o=e;e.l=a;this.s.push(a);d.o=a;a.l=d;this.F[this.L++]=!0}}}u.prototype={S:function(){return this.F.concat()}};function B(b,c,k,g){b.U.push([c.id,k.id,g.id])}
function w(b,c){function k(a,b){return Math.abs(a.x-b.x)<r.b.n&&Math.abs(a.y-b.y)<r.b.n}function g(a,b,c){if(Math.abs(r.b.O(b,a,c))>r.b.n)return!1;var d;Math.abs(a.y-b.y)<r.b.n?(d=b.x,a.x<c.x?(b=a.x,a=c.x):(b=c.x,a=a.x)):(d=b.y,a.y<c.y?(b=a.y,a=c.y):(b=c.y,a=a.y));return b-d<r.b.n&&d-a<r.b.n}for(var a=[],d,e,h,l=0;l<c.length;l++)d=D(b,c[l].x,c[l].y),e=!0,h=a.length-1,0<=h&&(k(d,a[h])?e=!1:0<h&&g(a[h-1],a[h],d)&&a.pop()),e&&a.push(d);h=a.length-1;0<h&&k(a[h],a[0])&&(a.pop(),h--);1<h&&(g(a[h-1],a[h],
a[0])&&(a.pop(),h--),1<h&&g(a[h],a[0],a[1])&&a.shift());return a}function x(b,c,k){return{R:b.L,a:c,i:k,p:1==r.b.G(k,c),o:null,l:null,H:null,I:null,v:!1,J:null,K:null,k:null,h:null,N:!1}}function D(b,c,k){c={id:b.Q.length,x:c,y:k,ea:[]};b.Q.push(c);return c};function E(b){this.j=b}E.prototype={};function F(b,c,k,g){this.q=b?b:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY};this.m=c?c:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY};this.t=k;this.r=g;this.depth=-1}F.prototype={};function G(b){var c=new F(b.q,b.m,b.t,b.r);c.e=b.e;c.f=b.f;c.c=b.c;c.d=b.d;c.u=b.u;return c}function H(b){this.A=b;b.u=this}H.prototype={};function I(b){var c=new F(null,null,null,null);this.B=[];J(this,c);this.root=new H(c);if(b)for(b=b.s,c=0;c<b.length;c++)b[c].H=b[c].I=this.root,b[c].v=!1}
I.prototype={};
function L(b,c){function k(){var a=m.e||m.f;a.c&&a.d?m==a.c?(p.e=null,a.c=s):(s.f=null,a.d=p):(p.e=null,p.f=a,a.d=p)}function g(a){m.m==t.m?(h?m.c?(a.e=s,s.c=a,p.d=null):(a.f=p,s.c=null,p.d=a):(a.e=s,a.f=p,s.c=p.d=a),s.d=p.c=null):(a.e&&a.f&&(a.e==m?(a.C=a.f,a.Y=!0):(a.C=a.e,a.Y=!1)),a.e=s,a.f=p,s.d=p.c=a,s.c=p.d=null)}function a(){var a;if(m.m==t.m&&h)m.c.e=s,m.d.f=p,s.c=m.c,p.d=m.d,a=s.d=p.c=null;else{m.c.e=s;m.d.f=p;var b=M(c,m.m);if(0<b)a=!0;else if(0>b)a=!1;else{a=m.c.r;var d=a.p,b=d?a.a:a.i,
b=M(c,b);0<b?a=!0:0>b?a=!1:(a=d?a.l:a.o,b=d?a.i:a.a,b=M(c,b),a=0<b?!0:!1)}a?(a=m.d,m.d.e=s,s.c=m.c,p.d=null):(a=m.c,m.c.f=p,p.d=m.d,s.c=null);s.d=p.c=a}return a}N(c);var d,e,h,l,f,n;c.p?(d=c.a,l=c.i,e=c.H,f=c.I,h=c.o.v,n=c.l.v):(d=c.i,l=c.a,e=c.I,f=c.H,h=c.l.v,n=c.o.v);n||(n=O(b,f,l,!1),f==e&&(e=n),f=n);f=f.A;if(f.e||f.f)if(f.q!=l)console.log("ERR add_segment: trFirstHigh != segHigh: ",f);else{h||(e=O(b,e,d,!0));var t=e.A,m=f,s,p,y,v;for(d=b.B.length+2;m;){if(0>--d){console.log("ERR add_segment: infinite loop",
m,c,b);return}if(!m.c&&!m.d){console.log("ERR add_segment: missing successors",m,c,b);return}e=m.u;e.g=c;e.A=null;v&&v.r==m.r?(s=m,p=v,p.m=m.m,e.left=new H(s),e.right=v.u):(y&&y.t==m.t?(p=m,s=y,s.m=m.m,e.left=y.u):(s=m,p=P(b,m),e.left=new H(s)),e.right=new H(p));m.e&&m.f?m.C?(m.Y?(p.e=m.f,p.f=m.C,p.e.c=p,p.f.d=p):(s.f=m.e,s.e=m.C,s.e.c=s,s.f.d=s),s.C=p.C=null):m.q==f.q?(p.f.d=p,s.f=p.e=null):p==m?(p.e=p.f,p.f=null,p.e.c=p):(s.f=s.e,s.e=null):k();m.c&&m.d?e=a():(e=m.c?m.c:m.d,g(e));s.r&&(s.r.J=p);
p.t&&(p.t.K=s);s.r=p.t=c;c.J=s;c.K=p;m.m!=t.m?(y=s,v=p,m=e):m=null}c.v=!0}else console.log("ERR add_segment: missing trFirst.uX: ",f)}
function Q(b,c){if(c)var k=b.a,g=b.i,a=b.H;else k=b.i,g=b.a,a=b.I;for(var d;a;)if(a.V)d=k==a.V?g:k,d=r.b.G(d,a.V),a=-1==d?a.left:a.right;else if(a.g)if(k==a.g.a||k==a.g.i)if(Math.abs(k.y-g.y)<r.b.n)a=Math.abs(a.g.a.y-a.g.i.y)<r.b.n?k==a.g.a?(d=g.x>k.x?g.x<a.g.i.x:g.x>=a.g.i.x)?b.o.p?a.right:a.left:a.g.l.p?a.right:a.left:(d=g.x>k.x?g.x<a.g.a.x:g.x>=a.g.a.x)?b.l.p?a.left:a.right:a.g.o.p?a.left:a.right:g.x<k.x?a.left:a.right;else if(d=M(a.g,g),0<d)a=a.left;else if(0>d)a=a.right;else if(d=k==a.g.a?(d=
a.g.p?g.y<a.g.i.y:g.y>=a.g.i.y)?M(a.g,b.o.a):-M(a.g,a.g.l.i):(d=a.g.p?g.y>=a.g.a.y:g.y<a.g.a.y)?M(a.g,b.l.i):-M(a.g,a.g.o.a),0<d)a=a.left;else if(0>d)a=a.right;else break;else if(d=M(a.g,k),0<d)a=a.left;else if(0>d)a=a.right;else if(d=M(a.g,g),0<d)a=a.left;else if(0>d)a=a.right;else if(d=M(a.g,c?b.o.a:b.l.i),0<d)a=a.left;else if(0>d)a=a.right;else break;else{a.A||console.log("ptNode: unknown type",a);c?b.H=a:b.I=a;break}}function N(b){Q(b,!0);Q(b,!1)}
function M(b,c){var k;k=b.a.x-c.x;var g=b.i.x-c.x,a=Math.abs(b.a.y-c.y)<r.b.n;if(Math.abs(b.i.y-c.y)<r.b.n){if(a)return 0;k=g}else if(!a)return b.p?r.b.O(b.a,b.i,c):r.b.O(b.i,b.a,c);return Math.abs(k)<r.b.n?0:k}function O(b,c,k,g){var a=c.A;if(a.q==k||a.m==k)return c;var d=G(a);a.m=d.q=k;a.c=d;d.e=a;a.d=d.f=null;d.c&&(d.c.e=d);d.d&&(d.d.f=d);J(b,d);c.V=k;c.A=null;c.right=new H(a);c.left=new H(d);return g?a.u:d.u}function P(b,c){var k=G(c);J(b,k);return k}
function J(b,c){c.ha=b.B.length;b.B.push(c)}function V(b){this.j=b;this.X=new I(this.j)}V.prototype={};
function W(b){var c=b.X,k=b.j.Q,g=Array(k.length);b=[];for(var a=0;a<k.length;a++)b.push({P:Array(8),Z:[]});a=0;for(k=c.B.length;a<k;a++){var d=c.B[a],e=d.e?d.f?5:7:d.f?4:6,h=d.c?d.d?1:0:d.d?3:2;if(1==d.depth%2){if(5==e||1==h||7==e&&3==h||4==e&&0==h)b[d.q.id].P[e]=d.m,b[d.m.id].P[h]=d.q}else null!=d.q.id&&(g[d.q.id]=e),null!=d.m.id&&(g[d.m.id]=h)}for(a=0;a<b.length;a++)if(c=b[a],d=g[a],null!=d){k=d;do 7<k++&&(k=0),c.P[k]&&c.Z.push(c.P[k]);while(k!=d)}g=[];for(a=0;a<b.length;a++)g[a]=b[a].Z.map(function(a){return a.id});
return g};function X(b){this.j=b;this.T=null}X.prototype={};function Z(b){this.j=b}Z.prototype={};function $(){this.M=null}
$.prototype={W:function(){this.M=null},S:function(){return this.M?this.M.S():null},fa:function(b,c){this.W();if(!b||0==b.length)return[];var k=new u(b),g=c?!1:1==k.L;if(g){g=new E(k);a:{var a=g.j,d=a.s[0],e=d,h=d,l=0;do l+=(h.a.x-h.i.x)*(h.a.y+h.i.y),h=h.l;while(h!=d);if(0>l){do e.k=e.l,e=e.h=e.o;while(e!=d);a.F[0]=!1}else{do e.k=e.o,e=e.h=e.l;while(e!=d)}for(d=a=d;a.h!=a.k;){b:{var e=a.k.a.x,h=a.k.a.y,l=a.a.x,f=a.a.y,n=a.h.a.x,t=a.h.a.y,m=n-l,s=t-f,p=e-n,y=h-t,v=l-e,K=f-h;if(r.b.n>v*s-m*K)e=!1;else{for(var Y=
a.k.k,C=a.h;C!=Y;){var C=C.h,z=C.a.x,A=C.a.y,R=z-e,S=A-h;if(0!=R||0!=S){var T=z-l,U=A-f;if(0!=T||0!=U)if(z-=n,A-=t,(0!=z||0!=A)&&m*U-s*T>=r.b.D&&v*S-K*R>=r.b.D&&p*A-y*z>=r.b.D){e=!1;break b}}}e=!0}}if(e)B(g.j,a.k.a,a.a,a.h.a),a.k.h=a.h,a.h.k=a.k,d=a=a.h;else if(a=a.h,a==d){g=!1;break a}}g=!0}}if(!g){g=new X(k);g.T=new V(g.j);d=g.T;a=d.j.s.concat();r.b.ba(a);e=0;h=d.j.L;if(1!=h)for(l=Array(h),f=a.concat(),n=0;n<f.length;n++)t=f[n].R,l[t]?a[h++]=f[n]:(a[e++]=f[n],l[t]=!0);e=a.length;h=d.X;l=0;for(f=
e;l<e;){f=Math.log(f)/Math.LN2;for(n=1<f?Math.floor(e/f):e;l<n;l++)L(h,a[l]);for(n=l;n<e;n++)N(a[n])}var d=d.j,h=[h.B[0]],l=[],q,n=0;do{for(t=1==n%2;f=h.pop();)-1==f.depth&&(f.depth=n,f.e&&h.push(f.e),f.f&&h.push(f.f),f.c&&h.push(f.c),f.d&&h.push(f.d),(q=f.t)&&-1==q.J.depth&&l.push(q.J),q=f.r)&&(-1==q.K.depth&&l.push(q.K),q.p!=t&&(d.F[q.R]=!1));h=l;l=[];n++}while(0<h.length);for(n=0;n<e;n++)a[n].J=a[n].K=null;e=W(g.T);h=g.j.Q;d=[];for(q=0;q<h.length;q++){l=h[q];f=[];for(a=0;a<e[q].length;a++)f.push({a:l,
i:h[e[q][a]],N:!1,k:null,h:null});d.push(f)}e=[];for(q=0;q<h.length;q++)for(l=h[q],a=0;a<d[q].length;a++)for(f=d[q][a],e[q]&&(f.k=e[q],e[q].h=f),n=d[f.i.id],f=0;f<n.length;f++)n[f].i==l&&(e[q]=n[f]);h=g.j.s;q=0;for(a=h.length;q<a;q++)if(l=h[q],g.j.F[l.R]?(l.k=l.o,l.h=l.l,f=l.i):(l=l.l,l.k=l.l,l.h=l.o,f=h[q].a),f=d[f.id],0<f.length&&(f[0].k=l,l.h=f[0]),f=e[l.a.id])f.h=l,l.k=f;for(q=0;q<d.length;q++)for(a=0;a<d[q].length;a++)g.j.s.push(d[q][a]);q=0;for(a=h.length;q<a;q++)d=g.j,d.w[d.w.length]=h[q];
q=g.j;l=[];for(f=0;f<q.w.length;f++){g=a=q.w[f];e=h=g.a;g.N=!0;g=g.h;for(n=!1;d=g.a;){if(g.N){d!=e&&(n=!0);break}else g.N=!0;1==r.b.G(d,h)&&(h=d,a=g);g=g.h}n||l.push(a)}q.w=l;q=g=new Z(k);g=q.j.w;q.j.U=[];for(a=0;a<g.length;a++)if(h=g[a],d=h.k,e=h.h,e.h==d)B(q.j,h.a,e.a,d.a);else if(d=q,e=h.h,h=h.a,l=[e.a],f=0,e=e.h,n=e.a,n!=h){for(;n!=h||1<f;)if(0<f)if(t=r.b.O(l[f],n,l[f-1]),Math.abs(t)<=r.b.n&&(n==h||r.b.G(l[f],n)==r.b.G(l[f],l[f-1]))&&(t=1),0<t)B(d.j,l[f-1],l[f],n),f--;else if(l[++f]=n,n==h)for(console.log("ERR uni-y-monotone: only concave angles left",
l);1<f;)f--,B(d.j,l[f-1],l[f],l[f+1]);else e=e.h,n=e.a;else l[++f]=n,e=e.h,n=e.a;B(d.j,l[f-1],l[f],n)}q=k.s;for(g=0;g<q.length;g++)q[g].a.ea=null}this.M=k;return k.U.concat()}};window.PNLTRI=r;r.REVISION=r.aa;r.Math=r.b;r.Triangulator=$;$.prototype.clear_lastData=$.prototype.W;$.prototype.get_PolyLeftArr=$.prototype.S;$.prototype.triangulate_polygon=$.prototype.fa;
