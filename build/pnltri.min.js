// pnltri.js / raw.github.com/jahting/pnltri.js/master/LICENSE
'use strict';var r={ea:"1.4"};r.d={random:Math.random,fa:function(b){for(var c=b.length-1;0<c;c--){var e=Math.floor(r.d.random()*(c+1)),f=b[c];b[c]=b[e];b[e]=f}return b},P:function(b,c,e){return(c.x-b.x)*(e.y-b.y)-(c.y-b.y)*(e.x-b.x)},ca:function(b){return Math.sqrt(b.x*b.x+b.y*b.y)},ha:function(b,c){return b.x*c.x+b.y*c.y},ga:function(b,c){return b.x*c.y-c.x*b.y},ia:function(b,c,e){c={x:c.x-b.x,y:c.y-b.y};b={x:e.x-b.x,y:e.y-b.y};e=r.d.ha(c,b)/r.d.ca(c)/r.d.ca(b);return 0<=r.d.ga(c,b)?1-e:3+e},H:function(b,c){var e=b.y-c.y;if(e<
r.d.F)return-1;if(e>r.d.k)return 1;e=b.x-c.x;return e<r.d.F?-1:e>r.d.k?1:0}};r.d.k=Math.pow(2,-43);r.d.F=-r.d.k;function v(b){this.da=[];this.q=[];this.N=0;this.G=[];this.o=[];this.W=[];if(b)for(var c=0,e=b.length;c<e;c++){var f=w(this,b[c]);if(3>f.length)console.log("Polygon has < 3 vertices!",f);else{for(var a=void 0,h=void 0,g=void 0,d=0;d<f.length-1;d++)a=x(this,f[d],f[d+1]),g?(a.n=g,g.m=a):h=a,g=a,this.q.push(a);a=x(this,f[f.length-1],f[0]);a.n=g;g.m=a;this.q.push(a);h.n=a;a.m=h;this.G[this.N++]=!0}}}v.prototype={T:function(){return this.G.concat()}};function B(b,c,e,f){b.W.push([c.id,e.id,f.id])}
function D(b,c,e,f,a){var h=E(e,f).Q,g=E(f,e).Q,d=F(b,{c:e,j:f,C:!0,h:h.h,g:g});e=F(b,{c:f,j:e,C:!1,h:g.h,g:h});h.h.g=d;g.h.g=e;h.h=e;g.h=d;h=b.o.length;a?(b.o[c]=d,b.o[h]=e):(b.o[c]=e,b.o[h]=d);return h}function E(b,c){for(var e,f,a=null,h=4,g=0;g<b.w.length;g++)e=b.w[g],(f=r.d.ia(b,e.X,c))<h&&(h=f,a=e);return a}function F(b,c){b.q.push(c);c.c.w.push({Q:c,X:c.j});return c}
function w(b,c){function e(a,b){return Math.abs(a.x-b.x)<r.d.k&&Math.abs(a.y-b.y)<r.d.k}function f(a,b,c){if(Math.abs(r.d.P(b,a,c))>r.d.k)return!1;var d;Math.abs(a.y-b.y)<r.d.k?(d=b.x,a.x<c.x?(b=a.x,a=c.x):(b=c.x,a=a.x)):(d=b.y,a.y<c.y?(b=a.y,a=c.y):(b=c.y,a=a.y));return b-d<r.d.k&&d-a<r.d.k}for(var a=[],h,g,d,m=0;m<c.length;m++)h=G(b,c[m].x,c[m].y),g=!0,d=a.length-1,0<=d&&(e(h,a[d])?g=!1:0<d&&f(a[d-1],a[d],h)&&a.pop()),g&&a.push(h);d=a.length-1;0<d&&e(a[d],a[0])&&(a.pop(),d--);1<d&&(f(a[d-1],a[d],
a[0])&&(a.pop(),d--),1<d&&f(a[d],a[0],a[1])&&a.shift());return a}function x(b,c,e){return{S:b.N,c:c,j:e,C:1==r.d.H(e,c),n:null,m:null,I:null,J:null,v:!1,K:null,L:null,h:null,g:null,U:!1}}function G(b,c,e){c={id:b.da.length,x:c,y:e,w:[]};b.da.push(c);return c};function H(b){this.i=b}H.prototype={};function I(b,c,e,f){this.u=b?b:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY};this.l=c?c:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY};this.p=e;this.r=f;this.depth=-1;this.V=!1}I.prototype={};function J(b){var c=new I(b.u,b.l,b.p,b.r);c.e=b.e;c.f=b.f;c.a=b.a;c.b=b.b;c.t=b.t;return c}function K(b){this.A=b;b.t=this}K.prototype={};
function L(b){var c=new I(null,null,null,null);this.B=[];N(this,c);this.root=new K(c);if(b)for(b=b.q,c=0;c<b.length;c++)b[c].I=b[c].J=this.root,b[c].v=!1}L.prototype={M:function(){for(var b,c=0,e=this.B.length;c<e;c++)if(b=this.B[c],1==b.depth%2&&!b.V&&(!b.e&&!b.f||!b.a&&!b.b)&&b.p)return b;return null}};
function O(b,c){function e(){var a=l.e||l.f;a.a&&a.b?l==a.a?(n.e=null,a.a=q):(q.f=null,a.b=n):(n.e=null,n.f=a,a.b=n)}function f(a){l.l==t.l?(d?l.a?(a.e=q,q.a=a,n.b=null):(a.f=n,q.a=null,n.b=a):(a.e=q,a.f=n,q.a=n.b=a),q.b=n.a=null):(a.e&&a.f&&(a.e==l?(a.D=a.f,a.ba=!0):(a.D=a.e,a.ba=!1)),a.e=q,a.f=n,q.b=n.a=a,q.a=n.b=null)}function a(){var a;if(l.l==t.l&&d)l.a.e=q,l.b.f=n,q.a=l.a,n.b=l.b,a=q.b=n.a=null;else{l.a.e=q;l.b.f=n;var b=P(c,l.l);if(0<b)a=l.b,l.b.e=q,q.a=l.a,n.b=null;else if(0>b)a=l.a,l.a.f=
n,n.b=l.b,q.a=null;else{a=l.a.r;var e=a.C,b=e?a.c:a.j,b=P(c,b);0<b?(a=l.b,l.b.e=q,q.a=l.a,n.b=null):0>b?(a=l.a,l.a.f=n,n.b=l.b,q.a=null):(a=e?a.m:a.n,b=e?a.j:a.c,b=P(c,b),0<b?(a=l.b,l.b.e=q,q.a=l.a,n.b=null):(a=l.a,l.a.f=n,n.b=l.b,q.a=null))}q.b=n.a=a}return a}Q(c);var h,g,d,m,k,p;c.C?(h=c.c,m=c.j,g=c.I,k=c.J,d=c.n.v,p=c.m.v):(h=c.j,m=c.c,g=c.J,k=c.I,d=c.m.v,p=c.n.v);p||(p=R(b,k,m,!1),k==g&&(g=p),k=p);k=k.A;if(k.e||k.f)if(k.u!=m)console.log("ERR add_segment: trFirstHigh != segHigh: ",k);else{d||(g=
R(b,g,h,!0));var t=g.A,l=k,q,n,y,u;for(h=b.B.length+2;l;){if(0>--h){console.log("ERR add_segment: infinite loop",l,c,b);return}if(!l.a&&!l.b){console.log("ERR add_segment: missing successors",l,c,b);return}g=l.t;g.s=c;g.A=null;u&&u.r==l.r?(q=l,n=u,n.l=l.l,g.left=new K(q),g.right=u.t):(y&&y.p==l.p?(n=l,q=y,q.l=l.l,g.left=y.t):(q=l,n=ba(b,l),g.left=new K(q)),g.right=new K(n));l.e&&l.f?l.D?(l.ba?(n.e=l.f,n.f=l.D,n.e.a=n,n.f.b=n):(q.f=l.e,q.e=l.D,q.e.a=q,q.f.b=q),q.D=n.D=null):l.u==k.u?(n.f.b=n,q.f=n.e=
null):n==l?(n.e=n.f,n.f=null,n.e.a=n):(q.f=q.e,q.e=null):e();l.a&&l.b?g=a():(g=l.a?l.a:l.b,f(g));q.r&&(q.r.K=n);n.p&&(n.p.L=q);q.r=n.p=c;c.K=q;c.L=n;l.l!=t.l?(y=q,u=n,l=g):l=null}c.v=!0}else console.log("ERR add_segment: missing trFirst.uX: ",k)}
function S(b,c){if(c)var e=b.c,f=b.j,a=b.I;else e=b.j,f=b.c,a=b.J;for(var h;a;)if(a.Y)h=e==a.Y?f:e,h=r.d.H(h,a.Y),a=-1==h?a.left:a.right;else if(a.s)e==a.s.c||e==a.s.j?Math.abs(e.y-f.y)<r.d.k?a=f.x<e.x?a.left:a.right:(h=P(a.s,f),a=0<h?a.left:0>h?a.right:e==a.s.c?a.right:a.left):(h=P(a.s,e),0<h?a=a.left:0>h?a=a.right:(h=P(a.s,f),0<h?a=a.left:0>h?a=a.right:(h=P(a.s,c?b.n.c:b.m.j),a=0<h?a.left:a.right)));else{a.A||console.log("ptNode: unknown type",a);c?b.I=a:b.J=a;break}}
function Q(b){S(b,!0);S(b,!1)}function P(b,c){var e,f;f=b.c.x-c.x;var a=b.j.x-c.x;e=Math.abs(b.c.y-c.y)<r.d.k;if(Math.abs(b.j.y-c.y)<r.d.k){if(e)return 0;e=a}else if(e)e=f,f=a;else return b.C?r.d.P(b.c,b.j,c):r.d.P(b.j,b.c,c);return Math.abs(e)<r.d.k?Math.abs(f)<r.d.k?0:f:e}function R(b,c,e,f){var a=c.A;if(a.u==e||a.l==e)return c;var h=J(a);a.l=h.u=e;a.a=h;h.e=a;a.b=h.f=null;h.a&&(h.a.e=h);h.b&&(h.b.f=h);N(b,h);c.Y=e;c.A=null;c.right=new K(a);c.left=new K(h);return f?a.t:h.t}
function ba(b,c){var e=J(c);N(b,e);return e}function N(b,c){c.ka=b.B.length;b.B.push(c)}function X(b){this.i=b;this.$=new L(this.i)}X.prototype={M:function(){return this.$.M()}};function Y(b){this.i=b;this.aa=this.R=null}Y.prototype={};
function ca(b,c,e){var f=null,a=null;function h(){var a;return(a=g.pop())?(d=a[0],m=a[1],k=a[2],p=a[3],!0):!1}var g=[],d,m,k,p,t;null==f&&(a=!0,e.e?f=!0:e.a?f=!1:(a=!1,f=e.f?!0:!1));for(e&&g.push([e,f,a,c]);h();)if(!d.V){d.V=!0;if(!d.p||!d.r){console.log("ERR alyTrap: lseg/rseg missing",d);break}m?k?(c=d.e,e=d.f,f=d.a,a=d.b):(c=d.f,e=d.e,f=d.b,a=d.a):k?(c=d.a,e=d.b,f=d.e,a=d.f):(c=d.b,e=d.a,f=d.f,a=d.e);if(e||a)t=D(b.i,p,d.l,d.u,k);a&&g.push([a,m,!k,t]);e&&g.push([e,!m,!k,t]);f&&g.push([f,m,k,p]);
f||a||c&&g.push([c,!m,k,p])}};function Z(b){this.i=b}Z.prototype={};function $(){this.O=null}
$.prototype={Z:function(){this.O=null},T:function(){return this.O?this.O.T():null},ja:function(b,c){this.Z();if(!b||0==b.length)return[];var e=new v(b),f=c?!1:1==e.N;if(f){f=new H(e);a:{var a=f.i,h=a.q[0],g=h,d=h,m=0;do m+=(d.c.x-d.j.x)*(d.c.y+d.j.y),d=d.m;while(d!=h);if(0>m){do g.h=g.m,g=g.g=g.n;while(g!=h);a.G[0]=!1}else{do g.h=g.n,g=g.g=g.m;while(g!=h)}for(h=a=h;a.g!=a.h;){b:{var g=a.h.c.x,d=a.h.c.y,m=a.c.x,k=a.c.y,p=a.g.c.x,t=a.g.c.y,l=p-m,q=t-k,n=g-p,y=d-t,u=m-g,M=k-d;if(r.d.k>u*q-l*M)g=!1;else{for(var aa=
a.h.h,C=a.g;C!=aa;){var C=C.g,z=C.c.x,A=C.c.y,T=z-g,U=A-d;if(0!=T||0!=U){var V=z-m,W=A-k;if(0!=V||0!=W)if(z-=p,A-=t,(0!=z||0!=A)&&l*W-q*V>=r.d.F&&u*U-M*T>=r.d.F&&n*A-y*z>=r.d.F){g=!1;break b}}}g=!0}}if(g)B(f.i,a.h.c,a.c,a.g.c),a.h.g=a.g,a.g.h=a.h,h=a=a.g;else if(a=a.g,a==h){f=!1;break a}}f=!0}}if(!f){f=new Y(e);f.R=new X(f.i);h=f.R;a=h.i.q.concat();r.d.fa(a);g=0;d=h.i.N;if(1!=d)for(m=Array(d),k=a.concat(),p=0;p<k.length;p++)t=k[p].S,m[t]?a[d++]=k[p]:(a[g++]=k[p],m[t]=!0);g=a.length;d=h.$;m=0;for(k=
g;m<g;){k=Math.log(k)/Math.LN2;for(p=1<k?Math.floor(g/k):g;m<p;m++)O(d,a[m]);for(p=m;p<g;p++)Q(a[p])}var h=h.i,d=[d.B[0]],m=[],s,p=0;do{for(t=1==p%2;k=d.pop();)-1==k.depth&&(k.depth=p,k.e&&d.push(k.e),k.f&&d.push(k.f),k.a&&d.push(k.a),k.b&&d.push(k.b),(s=k.p)&&-1==s.K.depth&&m.push(s.K),s=k.r)&&(-1==s.L.depth&&m.push(s.L),s.C!=t&&(h.G[s.S]=!1));d=m;m=[];p++}while(0<d.length);for(p=0;p<g;p++)a[p].K=a[p].L=null;f.aa=f.R.M();s=f.i;for(h=0;h<s.q.length;h++)a=s.q[h],s.G[a.S]?(a.h=a.n,a.g=a.m,a.c.w.push({Q:a,
X:a.j})):(a=a.m,a.h=a.m,a.g=a.n,a.c.w.push({Q:a,X:s.q[h].c}));for(s=f.aa;s;)a=ca,h=f,g=f.i,d=g.o.length,g.o[d]=s.p,a(h,d,s),s=f.R.M();s=f.i;m=[];for(k=0;k<s.o.length;k++){f=a=s.o[k];g=d=f.c;f.U=!0;f=f.g;for(p=!1;(h=f.c)!=g;){if(f.U){p=!0;break}else f.U=!0;1==r.d.H(h,d)&&(d=h,a=f);f=f.g}p||m.push(a)}s.o=m;s=f=new Z(e);f=s.i.o;s.i.W=[];for(a=0;a<f.length;a++)if(d=f[a],h=d.h,g=d.g,g.g==h)B(s.i,d.c,g.c,h.c);else if(h=s,g=d.g,d=d.c,m=[g.c],k=0,g=g.g,p=g.c,p!=d){for(;p!=d||1<k;)if(0<k)if(t=r.d.P(p,m[k-
1],m[k]),Math.abs(t)<=r.d.k&&r.d.H(p,m[k])!=r.d.H(m[k],m[k-1])&&(t=1),0<t)B(h.i,m[k-1],m[k],p),k--;else if(m[++k]=p,p==d)for(console.log("ERR uni-y-monotone: only concave angles left",m);1<k;)k--,B(h.i,m[k-1],m[k],m[k+1]);else g=g.g,p=g.c;else m[++k]=p,g=g.g,p=g.c;B(h.i,m[k-1],m[k],p)}s=e.q;for(f=0;f<s.length;f++)s[f].c.w=null}this.O=e;return e.W.concat()}};window.PNLTRI=r;r.REVISION=r.ea;r.Math=r.d;r.Triangulator=$;$.prototype.clear_lastData=$.prototype.Z;$.prototype.get_PolyLeftArr=$.prototype.T;$.prototype.triangulate_polygon=$.prototype.ja;
