// pnltri.js / raw.github.com/jahting/pnltri.js/master/LICENSE
'use strict';var r={ea:"1.4"};r.d={random:Math.random,fa:function(b){for(var c=b.length-1;0<c;c--){var f=Math.floor(r.d.random()*(c+1)),e=b[c];b[c]=b[f];b[f]=e}return b},O:function(b,c,f){return(c.x-b.x)*(f.y-b.y)-(c.y-b.y)*(f.x-b.x)},ca:function(b){return Math.sqrt(b.x*b.x+b.y*b.y)},ha:function(b,c){return b.x*c.x+b.y*c.y},ga:function(b,c){return b.x*c.y-c.x*b.y},ia:function(b,c,f){c={x:c.x-b.x,y:c.y-b.y};b={x:f.x-b.x,y:f.y-b.y};f=r.d.ha(c,b)/r.d.ca(c)/r.d.ca(b);return 0<=r.d.ga(c,b)?1-f:3+f},S:function(b,c){var f=b.y-c.y;if(f<
r.d.F)return-1;if(f>r.d.k)return 1;f=b.x-c.x;return f<r.d.F?-1:f>r.d.k?1:0}};r.d.k=Math.pow(2,-43);r.d.F=-r.d.k;function v(b){this.da=[];this.q=[];this.M=0;this.G=[];this.o=[];this.W=[];if(b)for(var c=0,f=b.length;c<f;c++){var e=w(this,b[c]);if(3>e.length)console.log("Polygon has < 3 vertices!",e);else{for(var a=void 0,h=void 0,g=void 0,d=0;d<e.length-1;d++)a=x(this,e[d],e[d+1]),g?(a.n=g,g.m=a):h=a,g=a,this.q.push(a);a=x(this,e[e.length-1],e[0]);a.n=g;g.m=a;this.q.push(a);h.n=a;a.m=h;this.G[this.M++]=!0}}}v.prototype={T:function(){return this.G.concat()}};function B(b,c,f,e){b.W.push([c.id,f.id,e.id])}
function D(b,c,f,e,a){var h=E(f,e).P,g=E(e,f).P,d=F(b,{c:f,j:e,B:!0,h:h.h,g:g});f=F(b,{c:e,j:f,B:!1,h:g.h,g:h});h.h.g=d;g.h.g=f;h.h=f;g.h=d;h=b.o.length;a?(b.o[c]=d,b.o[h]=f):(b.o[c]=f,b.o[h]=d);return h}function E(b,c){for(var f,e,a=null,h=4,g=0;g<b.v.length;g++)f=b.v[g],(e=r.d.ia(b,f.X,c))<h&&(h=e,a=f);return a}function F(b,c){b.q.push(c);c.c.v.push({P:c,X:c.j});return c}
function w(b,c){function f(a,b){return Math.abs(a.x-b.x)<r.d.k&&Math.abs(a.y-b.y)<r.d.k}function e(a,b,c){if(Math.abs(r.d.O(b,a,c))>r.d.k)return!1;var d;Math.abs(a.y-b.y)<r.d.k?(d=b.x,a.x<c.x?(b=a.x,a=c.x):(b=c.x,a=a.x)):(d=b.y,a.y<c.y?(b=a.y,a=c.y):(b=c.y,a=a.y));return b-d<r.d.k&&d-a<r.d.k}for(var a=[],h,g,d,n=0;n<c.length;n++)h=G(b,c[n].x,c[n].y),g=!0,d=a.length-1,0<=d&&(f(h,a[d])?g=!1:0<d&&e(a[d-1],a[d],h)&&a.pop()),g&&a.push(h);d=a.length-1;0<d&&f(a[d],a[0])&&(a.pop(),d--);1<d&&(e(a[d-1],a[d],
a[0])&&(a.pop(),d--),1<d&&e(a[d],a[0],a[1])&&a.shift());return a}function x(b,c,f){return{R:b.M,c:c,j:f,B:1==r.d.S(f,c),n:null,m:null,H:null,I:null,u:!1,J:null,K:null,h:null,g:null,U:!1}}function G(b,c,f){c={id:b.da.length,x:c,y:f,v:[]};b.da.push(c);return c};function H(b){this.i=b}H.prototype={};function I(b,c,f,e){this.D=b?b:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY};this.l=c?c:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY};this.p=f;this.r=e;this.depth=-1;this.V=!1}I.prototype={};function J(b){var c=new I(b.D,b.l,b.p,b.r);c.e=b.e;c.f=b.f;c.a=b.a;c.b=b.b;c.t=b.t;return c}function K(b){this.w=b;b.t=this}K.prototype={};
function L(b){var c=new I(null,null,null,null);this.A=[];N(this,c);this.root=new K(c);if(b)for(b=b.q,c=0;c<b.length;c++)b[c].H=b[c].I=this.root,b[c].u=!1}L.prototype={L:function(){for(var b,c=0,f=this.A.length;c<f;c++)if(b=this.A[c],1==b.depth%2&&!b.V&&(!b.e&&!b.f||!b.a&&!b.b)&&b.p)return b;return null}};
function O(b,c){function f(){var a=l.e||l.f;a.a&&a.b?l==a.a?(m.e=null,a.a=p):(p.f=null,a.b=m):(m.e=null,m.f=a,a.b=m)}function e(a){l.l==t.l?(d?l.a?(a.e=p,p.a=a,m.b=null):(a.f=m,p.a=null,m.b=a):(a.e=p,a.f=m,p.a=m.b=a),p.b=m.a=null):(a.e&&a.f&&(a.e==l?(a.C=a.f,a.ba=!0):(a.C=a.e,a.ba=!1)),a.e=p,a.f=m,p.b=m.a=a,p.a=m.b=null)}function a(){var a;if(l.l==t.l&&d)l.a.e=p,l.b.f=m,p.a=l.a,m.b=l.b,a=p.b=m.a=null;else{l.a.e=p;l.b.f=m;var b=P(c,l.l);if(0<b)a=l.b,l.b.e=p,p.a=l.a,m.b=null;else if(0>b)a=l.a,l.a.f=
m,m.b=l.b,p.a=null;else{a=l.a.r;var e=a.B,b=e?a.c:a.j,b=P(c,b);0<b?(a=l.b,l.b.e=p,p.a=l.a,m.b=null):0>b?(a=l.a,l.a.f=m,m.b=l.b,p.a=null):(a=e?a.m:a.n,b=e?a.j:a.c,b=P(c,b),0<b?(a=l.b,l.b.e=p,p.a=l.a,m.b=null):(a=l.a,l.a.f=m,m.b=l.b,p.a=null))}p.b=m.a=a}return a}Q(c);var h,g,d,n,k,q;c.B?(h=c.c,n=c.j,g=c.H,k=c.I,d=c.n.u,q=c.m.u):(h=c.j,n=c.c,g=c.I,k=c.H,d=c.m.u,q=c.n.u);q||(n=R(b,k,n,!1),k==g&&(g=n),k=n);k=k.w;if(k.e||k.f){d||(g=R(b,g,h,!0));var t=g.w,l=k,p,m,y,u;for(h=b.A.length+2;l;){if(0>--h){console.log("ERR add_segment: infinite loop",
l,c,b);return}if(!l.a&&!l.b){console.log("ERR add_segment: missing successors",l,c,b);return}g=l.t;g.s=c;g.w=null;u&&u.r==l.r?(p=l,m=u,m.l=l.l,g.left=new K(p),g.right=u.t):(y&&y.p==l.p?(m=l,p=y,p.l=l.l,g.left=y.t):(p=l,m=ba(b,l),g.left=new K(p)),g.right=new K(m));l.e&&l.f?l.C?(l.ba?(m.e=l.f,m.f=l.C,m.e.a=m,m.f.b=m):(p.f=l.e,p.e=l.C,p.e.a=p,p.f.b=p),p.C=m.C=null):l.D==k.D?(m.f.b=m,p.f=m.e=null):m==l?(m.e=m.f,m.f=null,m.e.a=m):(p.f=p.e,p.e=null):f();l.a&&l.b?g=a():(g=l.a?l.a:l.b,e(g));p.r&&(p.r.J=m);
m.p&&(m.p.K=p);p.r=m.p=c;c.J=p;c.K=m;l.l!=t.l?(y=p,u=m,l=g):l=null}c.u=!0}else console.log("ERR add_segment: missing trFirst.uX: ",k)}
function S(b,c){if(c)var f=b.c,e=b.j,a=b.H;else f=b.j,e=b.c,a=b.I;for(var h;a;)if(a.Y)h=f==a.Y?e:f,h=r.d.S(h,a.Y),a=-1==h?a.left:a.right;else if(a.s)f==a.s.c||f==a.s.j?Math.abs(f.y-e.y)<r.d.k?a=e.x<f.x?a.left:a.right:(h=P(a.s,e),a=0<h?a.left:0>h?a.right:f==a.s.c?a.right:a.left):(h=P(a.s,f),0<h?a=a.left:0>h?a=a.right:(h=P(a.s,e),0<h?a=a.left:0>h?a=a.right:(e=c?b.n.c:b.m.j,h=P(a.s,e),a=0<h?a.left:a.right)));else{a.w||console.log("ptNode: unknown type",a);c?b.H=a:b.I=a;break}}
function Q(b){S(b,!0);S(b,!1)}function P(b,c){var f,e;e=b.c.x-c.x;var a=b.j.x-c.x;f=Math.abs(b.c.y-c.y)<r.d.k;if(Math.abs(b.j.y-c.y)<r.d.k){if(f)return 0;f=a}else if(f)f=e,e=a;else return b.B?r.d.O(b.c,b.j,c):r.d.O(b.j,b.c,c);return Math.abs(f)<r.d.k?Math.abs(e)<r.d.k?0:e:f}function R(b,c,f,e){var a=c.w;if(a.D==f||a.l==f)return c;var h=J(a);a.l=h.D=f;a.a=h;h.e=a;a.b=h.f=null;h.a&&(h.a.e=h);h.b&&(h.b.f=h);N(b,h);c.Y=f;c.w=null;c.right=new K(a);c.left=new K(h);return e?a.t:h.t}
function ba(b,c){var f=J(c);N(b,f);return f}function N(b,c){c.ka=b.A.length;b.A.push(c)}function X(b){this.i=b;this.$=new L(this.i)}X.prototype={L:function(){return this.$.L()}};function Y(b){this.i=b;this.aa=this.Q=null}Y.prototype={};
function ca(b,c,f){var e=null,a=null;function h(){var a;return(a=g.pop())?(d=a[0],n=a[1],k=a[2],q=a[3],!0):!1}var g=[],d,n,k,q,t;null==e&&(a=!0,f.e?e=!0:f.a?e=!1:(a=!1,e=f.f?!0:!1));for(f&&g.push([f,e,a,c]);h();)if(!d.V){d.V=!0;if(!d.p||!d.r){console.log("ERR alyTrap: lseg/rseg missing",d);break}n?k?(c=d.e,f=d.f,e=d.a,a=d.b):(c=d.f,f=d.e,e=d.b,a=d.a):k?(c=d.a,f=d.b,e=d.e,a=d.f):(c=d.b,f=d.a,e=d.f,a=d.e);if(f||a)t=D(b.i,q,d.l,d.D,k);a&&g.push([a,n,!k,t]);f&&g.push([f,!n,!k,t]);e&&g.push([e,n,k,q]);
e||a||c&&g.push([c,!n,k,q])}};function Z(b){this.i=b}Z.prototype={};function $(){this.N=null}
$.prototype={Z:function(){this.N=null},T:function(){return this.N?this.N.T():null},ja:function(b,c){this.Z();if(!b||0==b.length)return[];var f=new v(b),e=c?!1:1==f.M;if(e){e=new H(f);a:{var a=e.i,h=a.q[0],g=h,d=h,n=0;do n+=(d.c.x-d.j.x)*(d.c.y+d.j.y),d=d.m;while(d!=h);if(0>n){do g.h=g.m,g=g.g=g.n;while(g!=h);a.G[0]=!1}else{do g.h=g.n,g=g.g=g.m;while(g!=h)}for(h=a=h;a.g!=a.h;){b:{var g=a.h.c.x,d=a.h.c.y,n=a.c.x,k=a.c.y,q=a.g.c.x,t=a.g.c.y,l=q-n,p=t-k,m=g-q,y=d-t,u=n-g,M=k-d;if(r.d.k>u*p-l*M)g=!1;else{for(var aa=
a.h.h,C=a.g;C!=aa;){var C=C.g,z=C.c.x,A=C.c.y,T=z-g,U=A-d;if(0!=T||0!=U){var V=z-n,W=A-k;if(0!=V||0!=W)if(z-=q,A-=t,(0!=z||0!=A)&&l*W-p*V>=r.d.F&&u*U-M*T>=r.d.F&&m*A-y*z>=r.d.F){g=!1;break b}}}g=!0}}if(g)B(e.i,a.h.c,a.c,a.g.c),a.h.g=a.g,a.g.h=a.h,h=a=a.g;else if(a=a.g,a==h){e=!1;break a}}e=!0}}if(!e){e=new Y(f);e.Q=new X(e.i);h=e.Q;a=h.i.q.concat();r.d.fa(a);g=0;d=h.i.M;if(1!=d)for(n=Array(d),k=a.concat(),q=0;q<k.length;q++)t=k[q].R,n[t]?a[d++]=k[q]:(a[g++]=k[q],n[t]=!0);g=a.length;d=h.$;n=0;for(k=
g;n<g;){k=Math.log(k)/Math.LN2;for(q=1<k?Math.floor(g/k):g;n<q;n++)O(d,a[n]);for(q=n;q<g;q++)Q(a[q])}var h=h.i,d=[d.A[0]],n=[],s,q=0;do{for(t=1==q%2;k=d.pop();)-1==k.depth&&(k.depth=q,k.e&&d.push(k.e),k.f&&d.push(k.f),k.a&&d.push(k.a),k.b&&d.push(k.b),(s=k.p)&&-1==s.J.depth&&n.push(s.J),s=k.r)&&(-1==s.K.depth&&n.push(s.K),s.B!=t&&(h.G[s.R]=!1));d=n;n=[];q++}while(0<d.length);for(q=0;q<g;q++)a[q].J=a[q].K=null;e.aa=e.Q.L();s=e.i;for(h=0;h<s.q.length;h++)a=s.q[h],s.G[a.R]?(a.h=a.n,a.g=a.m,a.c.v.push({P:a,
X:a.j})):(a=a.m,a.h=a.m,a.g=a.n,a.c.v.push({P:a,X:s.q[h].c}));for(s=e.aa;s;)a=ca,h=e,g=e.i,d=g.o.length,g.o[d]=s.p,a(h,d,s),s=e.Q.L();s=e.i;n=[];for(k=0;k<s.o.length;k++){e=a=s.o[k];g=d=e.c;e.U=!0;e=e.g;for(q=!1;(h=e.c)!=g;){if(e.U){q=!0;break}else e.U=!0;1==r.d.S(h,d)&&(d=h,a=e);e=e.g}q||n.push(a)}s.o=n;s=e=new Z(f);e=s.i.o;s.i.W=[];for(a=0;a<e.length;a++)if(d=e[a],h=d.h,g=d.g,g.g==h)B(s.i,d.c,g.c,h.c);else if(h=s,g=d.g,d=d.c,n=[g.c],k=0,g=g.g,q=g.c,q!=d){for(;q!=d||1<k;)if(0<k)if(0<r.d.O(q,n[k-
1],n[k]))B(h.i,n[k-1],n[k],q),k--;else if(n[++k]=q,q==d)for(console.log("ERR uni-y-monotone: only concave angles left",n);1<k;)k--,B(h.i,n[k-1],n[k],n[k+1]);else g=g.g,q=g.c;else n[++k]=q,g=g.g,q=g.c;B(h.i,n[k-1],n[k],q)}s=f.q;for(e=0;e<s.length;e++)s[e].c.v=null}this.N=f;return f.W.concat()}};window.PNLTRI=r;r.REVISION=r.ea;r.Math=r.d;r.Triangulator=$;$.prototype.clear_lastData=$.prototype.Z;$.prototype.get_PolyLeftArr=$.prototype.T;$.prototype.triangulate_polygon=$.prototype.ja;
